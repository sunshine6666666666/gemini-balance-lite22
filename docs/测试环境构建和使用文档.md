# Gemini Balance Lite 22 æµ‹è¯•ç¯å¢ƒæ„å»ºå’Œä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•ç¯å¢ƒæ¦‚è¿°

### ç¯å¢ƒåˆ†ç¦»ç­–ç•¥
- ğŸ  **æœ¬åœ°å¼€å‘ç¯å¢ƒ**ï¼šç”¨äºæ—¥å¸¸å¼€å‘å’Œå¿«é€Ÿæµ‹è¯•
- ğŸ” **é¢„è§ˆæµ‹è¯•ç¯å¢ƒ**ï¼šç”¨äºåŠŸèƒ½éªŒè¯å’Œé›†æˆæµ‹è¯•
- ğŸš€ **ç”Ÿäº§ç¯å¢ƒ**ï¼šç”¨äºæ­£å¼æœåŠ¡ï¼Œè‡ªåŠ¨éƒ¨ç½²

### æµ‹è¯•ç¯å¢ƒé€‰æ‹©

æˆ‘ä»¬æ¨èä½¿ç”¨ **Vercelé¢„è§ˆç¯å¢ƒ + æœ¬åœ°å¼€å‘** çš„ç»„åˆæ–¹æ¡ˆï¼š

**ä¼˜åŠ¿ï¼š**
- âœ… **å®Œå…¨æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ**ï¼šEdge Functionsè¿è¡Œæ—¶ç¯å¢ƒä¸€è‡´
- âœ… **é›¶é…ç½®æˆæœ¬**ï¼šæ— éœ€é¢å¤–è®¾ç½®Dockeræˆ–å¤æ‚ç¯å¢ƒ
- âœ… **å›¢é˜Ÿåä½œå‹å¥½**ï¼šæ¯ä¸ªPRéƒ½æœ‰ç‹¬ç«‹çš„é¢„è§ˆURL
- âœ… **å®‰å…¨éš”ç¦»**ï¼šé¢„è§ˆç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨åˆ†ç¦»

## ğŸ› ï¸ ç¯å¢ƒæ­å»ºæŒ‡å—

### å‰ç½®è¦æ±‚
- Node.js 18+ 
- Git
- Vercel CLI

### 1. å®‰è£…Vercel CLI

```bash
# å…¨å±€å®‰è£…Vercel CLI
npm install -g vercel

# éªŒè¯å®‰è£…
vercel --version
```

### 2. é¡¹ç›®åˆå§‹åŒ–

```bash
# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone https://github.com/sunshine6666666666/gemini-balance-lite22.git
cd gemini-balance-lite22

# ç™»å½•Vercelè´¦æˆ·
vercel login

# åˆå§‹åŒ–é¡¹ç›®ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
vercel
```

### 3. ç¯å¢ƒå˜é‡é…ç½®

#### 3.1 æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®

åˆ›å»ºæœ¬åœ°ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.sample .env.local

# ç¼–è¾‘æœ¬åœ°é…ç½®
# æ³¨æ„ï¼š.env.local æ–‡ä»¶ä¸ä¼šè¢«æäº¤åˆ°Git
```

`.env.local` ç¤ºä¾‹é…ç½®ï¼š
```bash
# æœ¬åœ°å¼€å‘ç”¨çš„API Keys
BACKUP_API_KEYS=your_dev_api_key_1,your_dev_api_key_2,your_dev_api_key_3

# æœ¬åœ°å¼€å‘ç”¨çš„å¯ä¿¡API Keys
TRUSTED_API_KEYS=your_trusted_dev_key_1,your_trusted_dev_key_2

# å¼€å‘ç¯å¢ƒæ ‡è¯†
NODE_ENV=development
```

#### 3.2 é¢„è§ˆç¯å¢ƒé…ç½®

åˆ›å»ºé¢„è§ˆç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºé¢„è§ˆç¯å¢ƒé…ç½®
cp .env.sample .env.preview
```

`.env.preview` ç¤ºä¾‹é…ç½®ï¼š
```bash
# é¢„è§ˆç¯å¢ƒç”¨çš„API Keysï¼ˆå»ºè®®ä½¿ç”¨æµ‹è¯•ä¸“ç”¨çš„Keysï¼‰
BACKUP_API_KEYS=your_preview_api_key_1,your_preview_api_key_2

# é¢„è§ˆç¯å¢ƒç”¨çš„å¯ä¿¡API Keys
TRUSTED_API_KEYS=your_trusted_preview_key_1

# é¢„è§ˆç¯å¢ƒæ ‡è¯†
NODE_ENV=preview
```

#### 3.3 ç”Ÿäº§ç¯å¢ƒé…ç½®

åœ¨Vercel Dashboardä¸­é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼š

1. è®¿é—® [Vercel Dashboard](https://vercel.com/dashboard)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥ **Settings** â†’ **Environment Variables**
4. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```
Name: BACKUP_API_KEYS
Value: your_prod_api_key_1,your_prod_api_key_2,your_prod_api_key_3
Environment: Production

Name: TRUSTED_API_KEYS  
Value: your_trusted_prod_key_1,your_trusted_prod_key_2
Environment: Production
```

## ğŸš€ æµ‹è¯•ç¯å¢ƒä½¿ç”¨æŒ‡å—

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

#### å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
vercel dev

# æœåŠ¡å™¨å°†åœ¨ http://localhost:3000 å¯åŠ¨
```

#### æœ¬åœ°æµ‹è¯•æµç¨‹

1. **å¯åŠ¨æœåŠ¡**ï¼š
```bash
vercel dev
```

2. **æµ‹è¯•APIç«¯ç‚¹**ï¼š
```bash
# æµ‹è¯•åŸç”ŸGemini API
curl --location 'http://localhost:3000/v1beta/models/gemini-2.5-pro:generateContent' \
--header 'Content-Type: application/json' \
--header 'x-goog-api-key: your_test_api_key' \
--data '{
    "contents": [
        {
         "role": "user",
         "parts": [
            {
               "text": "Hello, this is a test"
            }
         ]
      }
    ]
}'

# æµ‹è¯•OpenAIå…¼å®¹API
curl --location 'http://localhost:3000/chat/completions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer your_test_api_key' \
--data '{
    "model": "gemini-2.5-pro",
    "messages": [
        {
            "role": "user",
            "content": "Hello, this is a test"
        }
    ]
}'
```

3. **æŸ¥çœ‹æ—¥å¿—**ï¼š
æœ¬åœ°å¼€å‘æœåŠ¡å™¨ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚æ—¥å¿—ã€‚

### é¢„è§ˆæµ‹è¯•ç¯å¢ƒ

#### éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒ

```bash
# éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒï¼ˆä¸å½±å“ç”Ÿäº§ï¼‰
vercel --prod=false

# æˆ–è€…ä½¿ç”¨åˆ«åéƒ¨ç½²
vercel --prod=false --name=my-test-branch
```

#### é¢„è§ˆç¯å¢ƒæµ‹è¯•æµç¨‹

1. **è·å–é¢„è§ˆURL**ï¼š
éƒ¨ç½²å®Œæˆåï¼ŒVercelä¼šæä¾›ä¸€ä¸ªé¢„è§ˆURLï¼Œä¾‹å¦‚ï¼š
`https://gemini-balance-lite22-abc123.vercel.app`

2. **æµ‹è¯•å®Œæ•´åŠŸèƒ½**ï¼š
ä½¿ç”¨é¢„è§ˆURLæ›¿æ¢æœ¬åœ°åœ°å€è¿›è¡Œæµ‹è¯•ï¼š

```bash
# æµ‹è¯•é¢„è§ˆç¯å¢ƒ
curl --location 'https://gemini-balance-lite22-abc123.vercel.app/chat/completions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer your_preview_api_key' \
--data '{
    "model": "gemini-2.5-pro",
    "messages": [
        {
            "role": "user",
            "content": "Hello from preview environment"
        }
    ]
}'
```

3. **éªŒè¯è´Ÿè½½å‡è¡¡**ï¼š
å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè§‚å¯ŸAPI Keyè½®è¯¢æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

### åˆ†æ”¯ç®¡ç†ç­–ç•¥

#### å¼€å‘åˆ†æ”¯å·¥ä½œæµ

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/add-audio-speech
git checkout -b fix/api-key-validation
git checkout -b refactor/code-structure

# 2. åœ¨åŠŸèƒ½åˆ†æ”¯ä¸Šå¼€å‘
# ... è¿›è¡Œä»£ç ä¿®æ”¹ ...

# 3. æœ¬åœ°æµ‹è¯•
vercel dev
# è¿›è¡Œæœ¬åœ°æµ‹è¯•

# 4. éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒæµ‹è¯•
git add .
git commit -m "feat: add audio speech endpoint"
git push origin feature/add-audio-speech

# 5. åˆ›å»ºé¢„è§ˆéƒ¨ç½²
vercel --prod=false

# 6. é¢„è§ˆç¯å¢ƒæµ‹è¯•é€šè¿‡åï¼Œåˆå¹¶åˆ°main
git checkout main
git merge feature/add-audio-speech
git push origin main
# è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹å’ŒéªŒè¯

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### 1. APIç«¯ç‚¹æµ‹è¯•

```bash
# æµ‹è¯•è„šæœ¬ï¼štest-endpoints.sh
#!/bin/bash

BASE_URL="http://localhost:3000"  # æœ¬åœ°æµ‹è¯•
# BASE_URL="https://your-preview-url.vercel.app"  # é¢„è§ˆç¯å¢ƒæµ‹è¯•

echo "Testing Gemini native API..."
curl -s "$BASE_URL/v1beta/models/gemini-2.5-pro:generateContent" \
  -H "Content-Type: application/json" \
  -H "x-goog-api-key: $TEST_API_KEY" \
  -d '{"contents":[{"role":"user","parts":[{"text":"Hello"}]}]}' \
  | jq .

echo "Testing OpenAI compatible API..."
curl -s "$BASE_URL/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TEST_API_KEY" \
  -d '{"model":"gemini-2.5-pro","messages":[{"role":"user","content":"Hello"}]}' \
  | jq .

echo "Testing models endpoint..."
curl -s "$BASE_URL/models" \
  -H "Authorization: Bearer $TEST_API_KEY" \
  | jq .
```

#### 2. è´Ÿè½½å‡è¡¡æµ‹è¯•

```bash
# æµ‹è¯•è„šæœ¬ï¼štest-load-balancing.sh
#!/bin/bash

BASE_URL="http://localhost:3000"
API_KEY="your_trusted_test_key"

echo "Testing load balancing with multiple requests..."
for i in {1..5}; do
  echo "Request $i:"
  curl -s "$BASE_URL/chat/completions" \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer $API_KEY" \
    -d '{"model":"gemini-2.5-pro","messages":[{"role":"user","content":"Test '$i'"}]}' \
    | jq -r '.id'
  sleep 1
done
```

#### 3. é”™è¯¯å¤„ç†æµ‹è¯•

```bash
# æµ‹è¯•æ— æ•ˆAPI Key
curl -s "$BASE_URL/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer invalid_key" \
  -d '{"model":"gemini-2.5-pro","messages":[{"role":"user","content":"Test"}]}' \
  | jq .

# æµ‹è¯•æ— æ•ˆè¯·æ±‚æ ¼å¼
curl -s "$BASE_URL/chat/completions" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TEST_API_KEY" \
  -d '{"invalid":"request"}' \
  | jq .
```

### æ€§èƒ½æµ‹è¯•

#### å¹¶å‘æµ‹è¯•

```bash
# ä½¿ç”¨Apache Benchè¿›è¡Œå¹¶å‘æµ‹è¯•
ab -n 100 -c 10 -H "Authorization: Bearer $TEST_API_KEY" \
   -H "Content-Type: application/json" \
   -p test-payload.json \
   "$BASE_URL/chat/completions"
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—æŸ¥çœ‹

#### æœ¬åœ°ç¯å¢ƒæ—¥å¿—
æœ¬åœ°å¼€å‘æ—¶ï¼Œæ‰€æœ‰æ—¥å¿—ç›´æ¥æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸­ã€‚

#### é¢„è§ˆç¯å¢ƒæ—¥å¿—
```bash
# æŸ¥çœ‹é¢„è§ˆç¯å¢ƒæ—¥å¿—
vercel logs https://your-preview-url.vercel.app
```

#### ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
```bash
# æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
vercel logs https://your-production-domain.com
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
åœ¨ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼š
```bash
DEBUG=true
LOG_LEVEL=debug
```

#### 2. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- æ‰“å¼€Networké¢æ¿æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
- æŸ¥çœ‹Consoleé¢æ¿çš„é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨Sourcesé¢æ¿è¿›è¡Œæ–­ç‚¹è°ƒè¯•

#### 3. APIæµ‹è¯•å·¥å…·
æ¨èä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡ŒAPIæµ‹è¯•ï¼š
- **Postman**ï¼šå›¾å½¢åŒ–APIæµ‹è¯•
- **curl**ï¼šå‘½ä»¤è¡Œæµ‹è¯•
- **HTTPie**ï¼šæ›´å‹å¥½çš„å‘½ä»¤è¡Œå·¥å…·

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœ¬åœ°æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # éœ€è¦18+

# æ£€æŸ¥Vercel CLIç‰ˆæœ¬
vercel --version

# é‡æ–°å®‰è£…ä¾èµ–
npm install

# æ¸…é™¤Vercelç¼“å­˜
vercel dev --debug
```

#### 2. API KeyéªŒè¯å¤±è´¥
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤API Keyæ ¼å¼æ­£ç¡®
- éªŒè¯ç™½åå•é…ç½®

#### 3. é¢„è§ˆç¯å¢ƒéƒ¨ç½²å¤±è´¥
```bash
# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
vercel logs

# æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
vercel env ls

# é‡æ–°éƒ¨ç½²
vercel --prod=false --force
```

### åº”æ€¥å¤„ç†

#### å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
```bash
# æŸ¥çœ‹éƒ¨ç½²å†å²
vercel ls

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
vercel rollback [deployment-url]
```

#### ç´§æ€¥ä¿®å¤æµç¨‹
1. åœ¨æœ¬åœ°å¿«é€Ÿä¿®å¤é—®é¢˜
2. éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒéªŒè¯
3. ç¡®è®¤æ— è¯¯åæ¨é€åˆ°mainåˆ†æ”¯
4. ç›‘æ§ç”Ÿäº§ç¯å¢ƒçŠ¶æ€

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœ¬åœ°åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] é¢„è§ˆç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•æ— æ˜æ˜¾ä¸‹é™
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

### éƒ¨ç½²åæ£€æŸ¥
- [ ] ç”Ÿäº§ç¯å¢ƒAPIå“åº”æ­£å¸¸
- [ ] è´Ÿè½½å‡è¡¡åŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸
- [ ] ç›‘æ§æŒ‡æ ‡æ­£å¸¸
- [ ] ç”¨æˆ·åé¦ˆæ­£å¸¸

## ğŸ”„ æŒç»­é›†æˆå»ºè®®

### GitHub Actionsé…ç½®
å¯ä»¥è€ƒè™‘æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹ï¼š

```yaml
# .github/workflows/test.yml
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'
      - run: npm install -g vercel
      - run: vercel dev &
      - run: sleep 10
      - run: ./test-endpoints.sh
```

è¿™æ ·å¯ä»¥ç¡®ä¿æ¯æ¬¡ä»£ç æäº¤éƒ½ç»è¿‡è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯ã€‚
